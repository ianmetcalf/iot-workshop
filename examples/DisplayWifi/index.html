<!DOCTYPE html>
<html lang="en-US">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="stylesheet" type="text/css" media="screen" href="/iot-workshop/css/style.css?v=0.1.0">


  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/ianmetcalf/iot-workshop">View on GitHub</a>

          <h1 id="project_title">iot workshop</h1>
          <h2 id="project_tagline">An introduction to embedded and iot</h2>

          
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <pre><code class="hljs c"><span class="hljs-comment">/*********************************************************************

  Example: Display wifi information

*********************************************************************/</span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> ARDUINO_SAMD_FEATHER_M0</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;WiFi101.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> ARDUINO_ARCH_ESP8266</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ESP8266WiFi.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> ARDUINO_ARCH_ESP32</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;WiFi.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> ARDUINO_ARCH_WICED</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> connectWiFi(args...) WiFi.begin(args)</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> isWiFiConnected() (WiFi.status() == WL_CONNECTED)</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> getRSSI() WiFi.RSSI()</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> getLocalIP() WiFi.localIP()</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> ARDUINO_ARCH_WICED</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;adafruit_feather.h&gt;</span></span>

  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> connectWiFi(args...) Feather.connect(args)</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> isWiFiConnected() Feather.connected()</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> getRSSI() Feather.RSSI()</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> getLocalIP() reverse(Feather.localIP())</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Adafruit_FeatherOLED_WiFi.h&gt;</span></span>

<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* ssid = <span class="hljs-string">&quot;iot workshop&quot;</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* password = <span class="hljs-string">&quot;burlingtoncode&quot;</span>;

Adafruit_FeatherOLED_WiFi display = Adafruit_FeatherOLED_WiFi();

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
  display.init();
  display.setBatteryVisible(<span class="hljs-literal">false</span>);
  display.setRSSIIcon(<span class="hljs-literal">true</span>);
  display.setRSSIAsPercentage(<span class="hljs-literal">true</span>);
  display.clearDisplay();

  <span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> ARDUINO_SAMD_FEATHER_M0</span>
  WiFi.setPins(<span class="hljs-number">8</span>, <span class="hljs-number">7</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>);

  <span class="hljs-keyword">if</span> (WiFi.status() == WL_NO_SHIELD) {
    display.println(<span class="hljs-string">&quot;WiFi not present&quot;</span>);
    display.display();
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>);
  }
  <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>

  <span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> ARDUINO_ARCH_ESP8266</span>
  WiFi.mode(WIFI_STA);
  <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>

  display.clearMsgArea();
  display.print(<span class="hljs-string">&quot;Connecting to WiFi...&quot;</span>);
  display.display();

  connectWiFi(ssid, password);

  <span class="hljs-keyword">do</span> {
    delay(<span class="hljs-number">1000</span>);
  } <span class="hljs-keyword">while</span> (!isWiFiConnected());

  display.clearMsgArea();
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{
  checkConnection();
  updateDisplay();
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">checkConnection</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> now = millis();
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> last = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">if</span> (now - last &gt;= <span class="hljs-number">10000</span>) {
    <span class="hljs-keyword">if</span> (!isWiFiConnected()) {
      connectWiFi(ssid, password);
    }

    last = now;
  }
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">updateDisplay</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> now = millis();
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> last = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">if</span> (now - last &gt;= <span class="hljs-number">1000</span>) {
    <span class="hljs-keyword">if</span> (isWiFiConnected()) {
      display.setConnected(<span class="hljs-literal">true</span>);
      display.setRSSI(getRSSI());
      display.setIPAddress(getLocalIP());
    } <span class="hljs-keyword">else</span> {
      display.setConnected(<span class="hljs-literal">false</span>);
      display.setRSSI(<span class="hljs-number">0</span>);
      display.setIPAddress(<span class="hljs-number">0</span>);
    }

    display.refreshIcons();
    last = now;
  }
}

<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> ARDUINO_ARCH_WICED</span>
<span class="hljs-keyword">uint32_t</span> reverse(<span class="hljs-keyword">uint32_t</span> x) {
  <span class="hljs-keyword">return</span> ((x &amp; <span class="hljs-number">0xFF</span>) &lt;&lt; <span class="hljs-number">24</span>) |
    ((x &amp; <span class="hljs-number">0xFF00</span>) &lt;&lt; <span class="hljs-number">8</span>) |
    ((x &amp; <span class="hljs-number">0xFF0000</span>) &gt;&gt; <span class="hljs-number">8</span>) |
    ((x &amp; <span class="hljs-number">0xFF000000</span>) &gt;&gt; <span class="hljs-number">24</span>);
}
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></code></pre>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        
        <p class="copyright">iot workshop maintained by <a href="http://metcalfbuilt.com">Ian Metcalf</a></p>
        
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    
  </body>
</html>
